\begin{tikzpicture}[>=latex, node distance=.5cm]

  \tikzstyle{other}=[fill=gray!20];

  \tikzstyle{layer}=[thick,rectangle, draw,minimum width=3.65cm,minimum
    height=.5cm, align=center];
  \tikzstyle{layerthin}=[outer sep=0, thick,rectangle, draw,minimum width=3.65cm,minimum
    height=.5cm, align=center];

  \tikzstyle{layermini}=[thick,rectangle, draw, minimum width=1.5cm,minimum height=.5cm,align=center];
  \tikzstyle{layerhalf}=[thick,rectangle, draw, minimum width=1.95cm,minimum height=.5cm,align=center];
  \tikzstyle{layeroverhalf}=[thick,rectangle, draw, minimum width=2.25cm,minimum height=.5cm,align=center];

  \tikzstyle{layers}=[thick,rectangle, draw, minimum
    width=1.75cm,minimum height=1cm,align=center];

  \tikzstyle{edge}=[->,thick];
  
  \draw node (coq) [layerthin, other] {Iris + Coq};
  %\draw node (iris) [layer, other,above of=coq] {Iris};
  %\draw node (goose) [layer, other, above of=iris] {Perennial + Goose};
  \draw node (jrnlcert) [layerthin, above of=coq] {Perennial 2.0};

  \draw node (go) [layerthin, other, left=1cm of jrnlcert] {Go};
  \draw node (gojrnl) [layer, above of=go] {\txn};
  \draw node (gnfs) [layermini, above=of gojrnl.west,anchor=west] {\gnfs};
  \draw node (simplenfs) [layerhalf, above=of gojrnl.east,anchor=east] {\simplenfs};
  \draw node (recexamp) [layerhalf, above of=simplenfs, font=\footnotesize] {Toy Client};

  \draw node (gojrnlspec) [layeroverhalf, above=.75cm of jrnlcert.east,anchor=east, font=\footnotesize] {\txn Spec};
  \draw node (simplenfsspec) [layeroverhalf, above of=gojrnlspec, font=\footnotesize] {\simplenfs Spec};
  \draw node (recspec) [layeroverhalf, above of=simplenfsspec, font=\footnotesize] {Example Spec};


  \tikzstyle{proofnode}=[dashed,rectangle, draw, minimum width=1.25cm,minimum height=.5cm,align=center];
  \draw node (proof1) [proofnode, above=0cm of jrnlcert.north west,anchor=south west] {Proof};
  \draw node (proof2) [proofnode, above of=proof1] {Proof};
  \draw node (proof3) [proofnode, above of=proof2] {Proof};

  \draw node (bin) [above=2.15cm of gojrnl] {\cc{a.out}};
  \draw [edge] (gojrnl.north)+(0,1.25cm) -- node[left] {\cc{go build}} (bin.south);

  \draw [edge, shorten >=.15cm, shorten <=.15cm] (gojrnl) -- (proof1);
  \draw [edge, shorten >=.15cm, shorten <=.15cm] (simplenfs) -- (proof2);
  \draw [edge, shorten >=.15cm, shorten <=.15cm] (recexamp) -- node[above] {Goose} (proof3);

  \path let \p1=(bin) in let \p2=(proof3) in node (ok) at (\x2, \y1) {OK?};
  \draw [edge, transform canvas={xshift=3.45cm}] (gojrnl.north)+(0,1.25cm) -- (bin.south);
  %\draw [edge, shorten >=.15cm, shorten <=.15cm] (proof3) -- node[right] {{\tt coqc}} (ok);

  %{\cc{go build}};
  % \draw node (coqgo) [layerm,above=of goose,anchor=north] {Coq
  %   representation of Go (\autoref{sec:goose})};
  % \draw node (perennial) [layerm,above=of iris.east,anchor=east] {\sys library
  %   for\\concurrency and recovery (\autoref{sec:proving})};
  % \draw node (proof) [layers,above=of perennial.west,anchor=west,fill=green!10,dashed] {Proof};
  % \draw node (spec) [layers,above= of perennial.east,anchor=east,fill=green!10,dashed] {Spec};

  % \draw node (code) [layers,left of=coqgo,node distance=5cm,fill=green!10,dashed] {Go src};
  % \draw node (bin) [layers,below=of code] {a.out};
  % \draw [edge] (code.south) -- node[right] {Go compiler} (bin.north);

  % \draw [edge] (code.east) -- node[above] {Goose} node[below] {Translator} (coqgo.west);
  % \draw [edge] (coqgo.east) -- (proof.west);
  % \draw [edge] (spec.west) -- (proof.east);

  % \draw [edge] (proof.north) -- node[above] {OK?} ($(proof.north)+(0.0,+0.3)$);
          
\end{tikzpicture}
