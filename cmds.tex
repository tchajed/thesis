\newcommand{\horizontalrule}{\rule{\textwidth}{0.5pt}}

%% semantic formatting
\newcommand{\code}[1]{\texttt{\detokenize{#1}}}
\newcommand{\cc}[1]{\mbox{\smaller[0.5]\texttt{\detokenize{#1}}}}
\newcommand{\scc}[1]{\mbox{\textsc{\detokenize{#1}}}}
\newcommand{\loc}[1]{\num[group-separator={,},group-minimum-digits=4]{#1}}

% \newidentmacro{foobar} creates \foobar that expands to foobar, with the right
% formatting to be an identifier.
\newcommand{\newidentmacro}[1]{\csdef{#1}{\mathtt{#1}}}
% \newdefmacro{foobar} is like \newidentmacro but it uses textlog to format the
% identifier
\newcommand{\newdefmacro}[1]{\csdef{#1}{\textlog{#1}}}

%% Code

\newcommand{\load}[1]{\operatorname{Load}(#1)}
\newcommand{\store}[2]{\operatorname{Store}(#1, #2)}

%% notation

% https://tex.stackexchange.com/questions/4194/how-to-typeset-haskell-operator-and-friends
\newcommand\mdoubleplus{\ensuremath{\mathbin{+\mkern-10mu+}}}
\newcommand{\mapupd}[2]{[#1 \mapsto #2]}

%% iris.sty extensions for Perennial

\newcommand{\sep}{*}

% \newcommand{\wpc}[3]{\operatorname{wpc} \, #1 \, \{#2\} \, \{#3\}}
\NewDocumentCommand\wpc{O{} m O{} o m m}%
  {\textlog{\syntax{wpc}}^{#1}_{#3\IfValueT{#4}{,#4}}\spac#2\spac{\syntaxbraced{#5}}\spac{\syntaxbraced{#6}}}

\newcommand{\recoverwith}{\circlearrowleft}
\NewDocumentCommand\wpr{O{} m m O{} m m}%
  {\textlog{\syntax{wpr}}^{#1}_{#4}\spac#2 \recoverwith #3 \spac{\syntaxbraced{#5}}\spac{\syntaxbraced{#6}}}

\newcommand{\wpcw}{\textlog{wpc}}
\newcommand{\wprw}{\textlog{wpr}}
\newcommand{\wpw}{\textlog{wp}}

\newcommand{\notval}[1]{\neg \textlog{value(#1)}}
\newcommand{\cbmask}{\textlog{B}}

\NewDocumentCommand \hoareC {m m m m}{
  \curlybracket{#1}\spac #2 \spac \curlybracket{#3}\curlybracket{#4}%
}

\NewDocumentCommand \hoareCV {O{c} m m m m}{
  {\begin{aligned}[#1]
      &\curlybracket{#2} \\
      &\quad{#3} \\
      &\curlybracket{#4} \\
      &\curlybracket{#5}
    \end{aligned}}%
}

\newcommand{\postcrash}{\mathop{\blacklozenge}}
\newcommand*{\preborrow}{\textlog{preborrow}}
%\newcommand*{\cInv}[2]{{\boxedassert{#1 \mathop{|} #2}}^{\lightning}}
\newcommand*{\cInv}[2]{{\boxedassert{#1 \mathop{|} #2}}}
%\NewDocumentCommand \cfupd {O{} O{}} {\mathord{{}^\lightning\kern-1.15ex\vsGen[]{{\mid\kern-0.5ex\Rrightarrow\kern-0.25ex}}^{#1}_{#2}\kern0.2ex}}

\newcommand{\SKIP}{\mathit{noop}}
\renewcommand{\Ret}[1]{\text{\textbf{ret}}\,\, #1,\,}

%% more Perennial stuff

\newcommand{\lock}[1]{\textlog{acquire}(#1)}
\newcommand{\unlock}[1]{\textlog{release}(#1)}
\newcommand{\newlock}{\textlog{newlock}()}

\newcommand{\prelock}[1]{\textlog{preLock}(#1)}
\newcommand{\islock}[2]{\textlog{isLock}(#1, #2)}
\newcommand{\locked}[1]{\textlog{locked}(#1)}

%\newcommand{\precrashlock}[1]{\textlog{preCrashLock}(#1)}
\newcommand{\iscrashlockNoArgs}{\textlog{isCrashLock}}
\newcommand{\iscrashlock}[3]{\iscrashlockNoArgs(#1, #2, #3)}
\newcommand{\crashlockedNoArgs}{\textlog{crashLocked}}
\newcommand{\crashlocked}[3]{\crashlockedNoArgs(#1, #2, #3)}
\newcommand{\precrashlock}[1]{\textlog{preCrashLock}(#1)}

% Disk FFI
\newcommand{\diskwriteNoArgs}{\textlog{DiskWrite}}
\newcommand{\diskreadNoArgs}{\textlog{DiskRead}}
\newcommand{\diskwrite}[2]{\diskwriteNoArgs(#1, #2)}
\newcommand{\diskread}[1]{\diskreadNoArgs(#1)}
\newcommand{\dmapsto}{\mapsto_\textsf{d}}
\newcommand{\vals}{vs}
\newcommand{\block}{b}
\newcommand{\addr}{a}

\newcommand{\memory}{m}
\newcommand{\disk}{d}

% newly defined here (durable(P) := P |- post_crash(P))
\newcommand{\durable}{\operatorname{durable}}

%%% GoJournal

% temporary commands for compatibility
\newcommand{\txn}{GoJournal\xspace}
\newcommand{\gnfs}{GoNFS\xspace}
\newcommand{\simplenfs}{SimpleNFS\xspace}

% abbreviations
\newcommand{\fstar}{F${}^\star$\xspace}
\newcommand{\lowstar}{Low${}^\star$\xspace}
\newcommand{\lambdarust}{$\lambda_{\mathrm{Rust}}$\xspace}

% GoJournal total
\newcommand{\gotxnLOC}{\loc{1345}}
\newcommand{\gotxnLOP}{\loc{25797}}
% \newcommand{\gotxnRatio}{18}
%
% \newcommand{\gnfsLOC}{\loc{2941}}
%
\newcommand{\simplenfsLOC}{\loc{462}}
\newcommand{\simplenfsLOP}{\loc{3749}}
\newcommand{\simplenfsRatio}{8}
%
\newcommand{\simplenfsCrashLOC}{\loc{44}}

%%% DaisyNFS

% soundness definitions
\newcommand{\refines}{\sqsubseteq}
\newcommand{\progeq}{\approx}

% ``type arg'', to write something like Goose<L>. I'm using angle brackets to
% match C++ and Rust.
\newcommand{\targ}[1]{\langle #1 \rangle}
\newcommand{\layer}{L}
% the type of operations O
\newcommand{\OP}{\mathcal{O}}
\newcommand{\crash}{\operatorname{crash}}
\newcommand{\gooselayer}[1]{\ensuremath{\mathtt{Go}\targ{\mathrm{#1}}}}
\newcommand{\compile}{C}
\newcommand{\impl}{I}
\newcommand{\init}{\operatorname{init}}

\newcommand{\server}{\texttt{s}}
\newcommand{\sdfy}{\ensuremath{\server_{\mathrm{dfy}}}}
\newcommand{\sdfyAlt}{\ensuremath{\tilde{\server}_{\mathrm{dfy}}}}
\newcommand{\stxn}{\sdfy}
\newcommand{\ssys}{\ensuremath{\server_{\mathrm{sys}}}}
\newcommand{\snfs}{\ensuremath{\server_{\mathrm{NFS}}}}
\newcommand{\txncode}{\texttt{txn}}
\newcommand{\linked}[1]{\ensuremath{\mathrm{link}(#1, \txncode)}}
\newcommand{\linkedcode}{\linked{\sdfy}}

\newcommand{\seqrefinement}{\operatorname{seq\_refinement}}

\newcommand{\atomically}[1]{\ensuremath{\mathtt{atomically}\,\{\, #1 \,\}}}
\newcommand{\atomiccomp}{\mathrm{atomically}\circ}

%%% Goose

% spacing for application
\newcommand{\app}{\:}
\newcommand{\seq}{;\,}
\newcommand{\defeq}{\triangleq}
\newcommand{\lappend}{\mdoubleplus}

\newcommand{\goosedef}[1]{\mathsf{#1}}
\newcommand{\goosekw}[1]{\ensuremath{\goosedef{\textcolor{blue}{#1}}}}
\newcommand{\goosetrue}{\goosekw{true}}
\newcommand{\goosefalse}{\goosekw{false}}
